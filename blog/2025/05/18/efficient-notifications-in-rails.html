<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel=icon href="/images/favicon.png" type="image/png"> <title>Efficient Notifications in Rails: Cron vs Sidekiq vs Solid Queue</title> <link href="/stylesheets/bootstrap.css" rel=stylesheet /><link href="/stylesheets/font-awesome.css" rel=stylesheet /><link href="/stylesheets/site.css" rel=stylesheet /> <script src="/javascripts/site.js"></script> </head> <body> <header class=header_area> <div class=main_menu> <nav class="navbar navbar-expand-lg navbar-light"> <div class=container> <a class="navbar-brand logo_h" href="/"> <img src="/images/logo.png" height=35 alt=""/> <h3>Chris Wawer</h3> </a> <button class=navbar-toggler type=button data-toggle=collapse data-target="#navbarSupportedContent" aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <div class="collapse navbar-collapse offset" id=navbarSupportedContent> <ul class="nav navbar-nav menu_nav justify-content-end"> <li class=nav-item> <a href="/" class=nav-link>Home</a> </li> <li class=nav-item> <a class=nav-link href="/about.html">About</a> </li> <li class=nav-item> <a class=nav-link href="/blog.html">Blog</a> </li> <li class=nav-item> <a class=nav-link href="/learning.html">Learning</a> </li> <li class=nav-item> <a class=nav-link href="/projects.html">Projects</a> </li> <li class=nav-item> <a class=nav-link href="/contact.html">Contact</a> </li> </ul> </div> </div> </nav> </div> </header> <section class="blog_area single-post-area section_gap"> <div class=container> <div class=row> <div class="col-lg-8 posts-list"> <div class="single-post row"> <div class=col-lg-12> <div class=feature-img> <img src="/images/blog/isometric-office-chaos-background.jpg" class=img-fluid alt=""/> </div> </div> <div class="col-lg-3 col-md-3"> <div class="blog_info text-right"> <div class=post_tag> <a href="tags/ruby-on-rails.html">Ruby on Rails</a>, <a href="tags/cron.html">Cron</a>, <a href="tags/sidekiq.html">Sidekiq</a>, <a href="tags/solid-queue.html">Solid Queue</a>, </div> <ul class="blog_meta list"> <li><a>18 May, 2025<i class="fa fa-calendar"></i></a></li> </ul> </div> </div> <div class="col-lg-9 col-md-9 blog_details"> <h2>Efficient Notifications in Rails: Cron vs Sidekiq vs Solid Queue</h2> <p class=excert> In modern web applications, timely notifications about upcoming or completed events are crucial for user engagement. Ruby on Rails offers multiple approaches to handle such background jobs, each with its own strengths and trade-offs. </p> </div> <div class=col-lg-12> <div class=row> <div class="col-lg-12 mt-25"> <h3 id=meeting-notifications-typical-requirements>Meeting Notifications: Typical Requirements</h3> <p>In an internal app used by a sales team to schedule meetings with clients, each meeting stores precise start and end times along with attendee information and time zone data. To improve punctuality and engagement, the system must send automated notifications:</p> <ul> <li><strong>30 minutes before the meeting</strong> — email and push reminders,</li> <li><strong>10 minutes after the meeting ends</strong> — email summaries.</li> </ul> <p>Additionally, there’s a need for notifications with longer lead times:</p> <ul> <li><strong>48 hours before the meeting</strong> — early reminders,</li> <li><strong>7 days after the meeting</strong> — satisfaction surveys.</li> </ul> <hr/> <h3 id=1-cron-job--simple-but-less-precise>1. Cron Job — Simple but Less Precise</h3> <p>The simplest approach is to run a cron job every few minutes that queries the database for meetings needing notifications.</p> <div class="language-ruby highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="c1"># app/services/notification_service.rb</span>
<span class="k">class</span> <span class="nc">NotificationService</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">send_due_notifications</span>
    <span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>

    <span class="c1"># Reminders roughly 30 minutes before the meeting</span>
    <span class="n">reminder_window_start</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">25</span><span class="p">.</span><span class="nf">minutes</span>
    <span class="n">reminder_window_end</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">35</span><span class="p">.</span><span class="nf">minutes</span>
    <span class="no">Meeting</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">start_time: </span><span class="n">reminder_window_start</span><span class="o">..</span><span class="n">reminder_window_end</span><span class="p">).</span><span class="nf">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">meeting</span><span class="o">|</span>
      <span class="no">NotificationMailer</span><span class="p">.</span><span class="nf">reminder</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_later</span>
    <span class="k">end</span>

    <span class="c1"># Follow-ups roughly 10 minutes after meeting ends</span>
    <span class="n">follow_up_window_start</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="mi">15</span><span class="p">.</span><span class="nf">minutes</span>
    <span class="n">follow_up_window_end</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="mi">5</span><span class="p">.</span><span class="nf">minutes</span>
    <span class="no">Meeting</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">end_time: </span><span class="n">follow_up_window_start</span><span class="o">..</span><span class="n">follow_up_window_end</span><span class="p">).</span><span class="nf">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">meeting</span><span class="o">|</span>
      <span class="no">NotificationMailer</span><span class="p">.</span><span class="nf">follow_up</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_later</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h4 id=pros-and-cons>Pros and Cons</h4> <ul> <li><strong>Pros:</strong> <ul> <li>Minimal infrastructure requirements,</li> <li>Easy to implement quickly.</li> </ul> </li> <li><strong>Cons:</strong> <ul> <li>Notifications are only as precise as the cron interval (may be delayed by several minutes),</li> <li>Increased database load with many meetings,</li> <li>Risk of duplicate notifications without additional safeguards.</li> </ul> </li> </ul> <hr/> <h3 id=2-sidekiq--precise-and-scalable-background-jobs>2. Sidekiq — Precise and Scalable Background Jobs</h3> <p>Sidekiq enables scheduling jobs to execute at an exact time via <code>perform_at</code> or ActiveJob’s <code>set(wait_until:)</code>.</p> <h4 id=example-job-and-scheduling>Example Job and Scheduling</h4> <div class="language-ruby highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="k">class</span> <span class="nc">MeetingNotificationJob</span>
  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">meeting_id</span><span class="p">,</span> <span class="n">notification_type</span><span class="p">)</span>
    <span class="n">meeting</span> <span class="o">=</span> <span class="no">Meeting</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">meeting_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="n">meeting</span>

    <span class="k">case</span> <span class="n">notification_type</span>
    <span class="k">when</span> <span class="s1">'reminder'</span>
      <span class="no">MeetingMailer</span><span class="p">.</span><span class="nf">reminder</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_now</span>
      <span class="c1"># Add push notification logic here</span>
    <span class="k">when</span> <span class="s1">'follow_up'</span>
      <span class="no">MeetingMailer</span><span class="p">.</span><span class="nf">follow_up</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Scheduling jobs when creating or updating a meeting:</span>
<span class="n">reminder_time</span> <span class="o">=</span> <span class="n">meeting</span><span class="p">.</span><span class="nf">start_time</span> <span class="o">-</span> <span class="mi">30</span><span class="p">.</span><span class="nf">minutes</span>
<span class="n">follow_up_time</span> <span class="o">=</span> <span class="n">meeting</span><span class="p">.</span><span class="nf">end_time</span> <span class="o">+</span> <span class="mi">10</span><span class="p">.</span><span class="nf">minutes</span>

<span class="no">MeetingNotificationJob</span><span class="p">.</span><span class="nf">perform_at</span><span class="p">(</span><span class="n">reminder_time</span><span class="p">,</span> <span class="n">meeting</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="s1">'reminder'</span><span class="p">)</span> <span class="k">if</span> <span class="n">reminder_time</span> <span class="o">&gt;</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="no">MeetingNotificationJob</span><span class="p">.</span><span class="nf">perform_at</span><span class="p">(</span><span class="n">follow_up_time</span><span class="p">,</span> <span class="n">meeting</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span> <span class="s1">'follow_up'</span><span class="p">)</span> <span class="k">if</span> <span class="n">follow_up_time</span> <span class="o">&gt;</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
</code></pre></div></div> <h4 id=important-note-on-memory-usage>Important Note on Memory Usage</h4> <p>Sidekiq workers run persistently in memory, and while Redis efficiently stores the queued jobs, the number of scheduled jobs and especially jobs scheduled far in the future can increase memory consumption on the Sidekiq process.</p> <ul> <li>The longer the jobs remain scheduled and the larger the volume of scheduled jobs, the more memory Sidekiq may require to manage them efficiently.</li> <li>Scaling Sidekiq for high volume or long-delay jobs typically involves increasing the number of worker processes, which raises memory usage.</li> <li>Careful monitoring and tuning are essential in large-scale or long-delay scheduling scenarios to avoid excessive memory consumption.</li> </ul> <h2 id=3-solid-queue--rails-8-built-in-database-backed-queue>3. Solid Queue — Rails 8 Built-in Database-backed Queue</h2> <p>Solid Queue is a database-backed job queue designed to simplify background job processing without adding external dependencies. This design brings clear, practical advantages for your project:</p> <h3 id=key-project-benefits>Key Project Benefits:</h3> <ul> <li> <p><strong>Reduced Operational Complexity:</strong></p> <p>No need to install, configure, and maintain an additional Redis server or other queue services. This means fewer moving parts, less infrastructure to monitor, and less risk of downtime due to external service failure.</p> </li> <li> <p><strong>Transactional Integrity:</strong></p> <p>Jobs are enqueued within the same database transaction as your business logic. This ensures <strong>atomicity</strong> — if your transaction rolls back, the job won’t be enqueued, preventing out-of-sync states between your app and job queue.</p> </li> <li> <p><strong>Easier Debugging and Transparency:</strong></p> <p>Since all jobs are stored in your primary database, developers and operations teams can directly query job tables, track job statuses, and debug failed jobs using familiar tools — no need to connect to separate systems or specialized dashboards.</p> </li> <li> <p><strong>Simplified Deployment and Scalability for Small to Medium Projects:</strong></p> <p>Deploying your app becomes easier because you only manage one data store. For many projects, this reduces the barrier to adding background processing and helps maintain a smaller infrastructure footprint.</p> </li> <li> <p><strong>Immediate Productivity Boost:</strong></p> <p>Developers can start implementing background jobs quickly without waiting for infrastructure approval or setup, speeding up feature delivery.</p> </li> </ul> <h3 id=how-scheduling-works-in-solid-queue>How Scheduling Works in Solid Queue</h3> <ul> <li>When calling <code>set(wait_until: time).perform_later(...)</code>, the job is saved in a database table along with the scheduled execution time,</li> <li>Rails workers periodically query the database for jobs due to run,</li> <li>Jobs are executed in the application context,</li> <li>Jobs remain persisted in the database across restarts, ensuring reliability,</li> <li>Database locking and transactions prevent duplicate execution and race conditions.</li> </ul> <h3 id=implementation-example>Implementation Example</h3> <div class="language-ruby highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="k">class</span> <span class="nc">MeetingNotificationJob</span> <span class="o">&lt;</span> <span class="no">ApplicationJob</span>
  <span class="n">queue_as</span> <span class="ss">:default</span>

  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">meeting_id</span><span class="p">,</span> <span class="n">notification_type</span><span class="p">)</span>
    <span class="n">meeting</span> <span class="o">=</span> <span class="no">Meeting</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">id: </span><span class="n">meeting_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="n">meeting</span>

    <span class="k">case</span> <span class="n">notification_type</span>
    <span class="k">when</span> <span class="s1">'reminder'</span>
      <span class="no">MeetingMailer</span><span class="p">.</span><span class="nf">reminder</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_now</span>
    <span class="k">when</span> <span class="s1">'follow_up'</span>
      <span class="no">MeetingMailer</span><span class="p">.</span><span class="nf">follow_up</span><span class="p">(</span><span class="n">meeting</span><span class="p">).</span><span class="nf">deliver_now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Meeting</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">after_commit</span> <span class="ss">:schedule_notifications</span><span class="p">,</span> <span class="ss">on: </span><span class="p">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:update</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">schedule_notifications</span>
    <span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
    <span class="n">reminder_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">-</span> <span class="mi">30</span><span class="p">.</span><span class="nf">minutes</span>
    <span class="n">follow_up_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">+</span> <span class="mi">10</span><span class="p">.</span><span class="nf">minutes</span>

    <span class="no">MeetingNotificationJob</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="ss">wait_until: </span><span class="n">reminder_time</span><span class="p">).</span><span class="nf">perform_later</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">'reminder'</span><span class="p">)</span> <span class="k">if</span> <span class="n">reminder_time</span> <span class="o">&gt;</span> <span class="n">now</span>
    <span class="no">MeetingNotificationJob</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="ss">wait_until: </span><span class="n">follow_up_time</span><span class="p">).</span><span class="nf">perform_later</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s1">'follow_up'</span><span class="p">)</span> <span class="k">if</span> <span class="n">follow_up_time</span> <span class="o">&gt;</span> <span class="n">now</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id=extended-example-notifications-with-longer-lead-times>Extended Example: Notifications with Longer Lead Times</h3> <p>For cases needing notifications well in advance or long after the meeting:</p> <ul> <li><strong>48 hours before the meeting</strong> — early reminders,</li> <li><strong>7 days after the meeting</strong> — satisfaction surveys.</li> </ul> <h3 id=notes-on-long-interval-notifications-and-sidekiq>Notes on Long-Interval Notifications and Sidekiq</h3> <p>Sidekiq stores jobs in Redis, which is an in-memory database. This provides very fast access to queued jobs and works excellently for short delays or jobs executed almost immediately.</p> <p>However, in scenarios where notifications need to be sent far in advance (e.g., 48 hours before a meeting) or long after an event (e.g., 7 days after a meeting), Sidekiq must keep these jobs in Redis memory for the entire waiting period.</p> <p>This means that each job scheduled hours or days ahead occupies RAM space continuously, which, when scaled to many such long-delayed jobs, can lead to significant memory consumption and degrade overall system performance.</p> <h3 id=why-storing-jobs-in-the-database-is-better-for-long-delays>Why Storing Jobs in the Database Is Better for Long Delays</h3> <p>An alternative approach is to use a database-backed job queue that stores jobs on disk rather than in RAM. This way, long-waiting jobs do not consume precious memory resources and are only loaded when it’s time to execute them.</p> <p>For example, Active Job with a database adapter (like Delayed Job, Que, or a custom solution) allows you to schedule jobs inside the database, optimized for storing large numbers of records over long periods. Instead of holding them in memory, the jobs are simply queried and run at their scheduled time.</p> <h3 id=summary-and-recommendations>Summary and Recommendations</h3> <table> <thead> <tr> <th>Approach</th> <th>Precision</th> <th>Memory Usage</th> <th>Scalability</th> <th>Infrastructure Requirements</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td>Cron Job</td> <td>Low</td> <td>Minimal</td> <td>Limited</td> <td>None</td> <td>Easy to set up but less precise</td> </tr> <tr> <td>Sidekiq</td> <td>Very High</td> <td>Moderate</td> <td>Very High</td> <td>Redis + Worker Processes + RAM</td> <td>Great for large scale, requires resources</td> </tr> <tr> <td>Solid Queue</td> <td>High</td> <td>Low to Moderate</td> <td>Good</td> <td>Database + Rails Workers</td> <td>Native Rails 8 support, minimal infra</td> </tr> </tbody> </table> <p>For most Rails 8 projects with moderate scale, <strong>Solid Queue</strong> offers an excellent balance of precision, reliability, and simplicity without extra dependencies. As load grows, Sidekiq can be integrated for greater scalability and monitoring features.</p> </div> </div> </div> </div> </div> <div class=col-lg-4> <div class=blog_right_sidebar> <aside class="single-sidebar-widget tag_cloud_widget"> <h4 class=widget_title>Tag Clouds</h4> <ul class=list> <li><a href="tags/ruby-on-rails.html">Ruby on Rails</a></li> <li><a href="tags/cron.html">Cron</a></li> <li><a href="tags/sidekiq.html">Sidekiq</a></li> <li><a href="tags/solid-queue.html">Solid Queue</a></li> </ul> </aside> </div> </div> </div> </div> </section> <footer class=footer_area> <div class=container> <div class="row justify-content-center"> <div class=col-lg-12> <div class="footer_top flex-column"> <div class=footer_logo> <h4>Follow Me</h4> </div> <div class=footer_social> <a href="https://www.linkedin.com/in/chris-wawer/" target=_blank><i class="fa fa-linkedin"></i></a> <a href="https://x.com/chris_wawer" target=_blank><i class="fa fa-twitter"></i></a> <a href="http://github.com/wafcio" target=_blank><i class="fa fa-github"></i></a> </div> </div> </div> </div> <div class="row footer_bottom justify-content-center"> <p class="col-lg-8 col-sm-12 footer-text"> Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden=true></i> by <a href="https://colorlib.com" target=_blank>Colorlib</a> </p> </div> </div> </footer> <script src="js/jquery-3.2.1.min.js"></script> <script src="js/popper.js"></script> <script src="js/bootstrap.min.js"></script> <script src="js/stellar.js"></script> <script src="js/jquery.magnific-popup.min.js"></script> <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script> <script src="vendors/isotope/imagesloaded.pkgd.min.js"></script> <script src="vendors/isotope/isotope-min.js"></script> <script src="vendors/owl-carousel/owl.carousel.min.js"></script> <script src="js/jquery.ajaxchimp.min.js"></script> <script src="js/mail-script.js"></script> <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script> <script src="js/gmaps.min.js"></script> <script src="js/theme.js"></script> </body> </html>